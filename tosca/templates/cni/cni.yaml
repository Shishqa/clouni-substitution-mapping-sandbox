tosca_definitions_version: tosca_simple_yaml_1_3

imports:

- ../../profiles/cni/main.yaml

topology_template:

  inputs:

    component_version:
      type: version

  node_templates:

    cni:
      type: kubetos.nodes.CNI
      capabilities:
        cni:
          properties:
            binary_dir: /opt/cni/bin
            config_dir: /etc/cni/net.d
      interfaces:
        Standard:
          operations:
            create:
              inputs:
                cni_binary_dir: { get_property: [ SELF, cni, binary_dir ] }
                cni_config_dir: { get_property: [ SELF, cni, config_dir ] }
                cni_version: { concat: [ "v", { get_property: [ SELF, component_version ] } ] }
              implementation:
                primary: ansible/cni--create.yaml
                dependencies:
                  - cni_role
                  - download_role
      artifacts:
        cni_role:
          file: ansible/roles/cni
          type: tosca.artifacts.File
          deploy_path: roles/cni
        download_role:
          file: ../../utils/roles/download
          type: tosca.artifacts.File
          deploy_path: roles/download

  substitution_mappings:
    node_type: kubetos.nodes.CNI
    capabilities:
      cni: [ cni, cni ]
    properties:
      component_version: [ component_version ]
    requirements:
      host: [ cni, host ]

tosca_definitions_version: tosca_simple_yaml_1_3

imports:

- ../profiles/cri/main.yaml

topology_template:

  inputs:

    component_version:
      type: version

  node_templates:

    crictl:
      type: kubetos.nodes.Crictl
      interfaces:
        Standard:
          operations:
            create:
              inputs:
                crictl_version: { concat: [ "v", { get_property: [ SELF, component_version ] } ] }
                cri_socket: { get_property: [ SELF, cri_runtime, cri, url_path ] }
              implementation:
                primary: ansible/crictl--create.yaml
                dependencies:
                  - crictl_role
                  - download_role
      artifacts:
        crictl_role:
          file: ansible/roles/crictl
          type: tosca.artifacts.File
          deploy_path: roles/crictl
        download_role:
          file: ../../utils/roles/download
          type: tosca.artifacts.File
          deploy_path: roles/download

  substitution_mappings:
    node_type: kubetos.nodes.Crictl
    properties:
      component_version: [ component_version ]
    requirements:
      host: [ crictl, host ]
      cri_runtime: [ crictl, cri_runtime ]
